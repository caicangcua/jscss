"use strict";ComApp.app.maCurrentView.__$cartPopup=function(e,t){var n,a,i,o=$("<div class='shared_popup placeorder'></div>").appendTo(".dx-viewport"),r={},c=function(i){var o=t.find(".dathangcase"),c=t.find(".deliverytime"),l=c.children().first();r[3]=$(o[3]).clone(),$(o[3]).remove(),r[2]=$(o[2]).clone(),$(o[2]).remove(),r[0]=$(o[0]).clone(),$(o[0]).remove();var d={},u=e._cartData(),p=e._deliInfo(),h=t.find(".scrollbody"),m=function(t,n){e._cbCart(t.parent().data().id,{sl:n})},v=function(e,n){if(e){var a=u[e.data().id];n?a.sl=n:e.find(".col-qty input").val(a.sl),e.find(".col-total p").html(_Tien(a.sl*a.giaban,0)).removeAttr("style").autoSizr()}var i=t.find(".tf .row .subtotal");i[0].innerHTML=_Tien(0,0),i[1].innerHTML=_Tien(0,0);var o=0;$.each(u,function(e,t){o+=t.sl*t.giaban}),i[2].innerHTML=_Tien(o,0)},g=1,w=h.children().first();w.detach(),$.each(u,function(t,n){var a,i,o=w.clone();g%2==0&&o.addClass("row row-bg2"),o.data("id",t),o.find(".a_qty").click(function(e){var t=$(this).parent(),n=t.find("input"),a=parseInt(n.val()),i=$(this).hasClass("qty-plus");(a>1||i)&&(m(t,a+(i?1:-1)),v(t.parent()))}),o.find(".removeitem").click(function(t){var n=this;DevExpress.ui.dialog.confirm('<div style="text-align:center;max-width:300px">'+gbM("S1_027")+"</div>","Confirm changes").done(function(t){if(t){var a=2,i=function(){0==--a&&($.isEmptyObject(u)?f.hide():v())};setTimeout(function(){e._rmvOutCart($(n).parent().data().id,i)}),setTimeout(function(){$(n).parent().fadeOut("slow",function(e){$(this).remove(),i()})},10)}})}),i=u[(a=o).data().id],a.find(".col-pro >*").each(function(e,t){switch(t.tagName.toLowerCase()){case"span":t.innerHTML="G: "+_Tien(i.giaban,0)+"<br/>Vat: "+_Tien(i.v,0);break;case"img":var n=i.imgs.split(",");n.length>0&&""!=n[0]&&(t.src=n[0]);break;case"p":t.innerHTML=i.ten}}),a.find(".col-price").html("<p>"+_Tien(i.giaban,0)+"</p>"),a.find(".col-vat p").html(_Tien(i.v,0)),a.find(".col-qty input").change(function(){var e=$(this),t=e.val();""==t&&(t=1,e.val(1)),m(e.parent(),e.val()),v(e.parent().parent(),t)}),v(a),h.append(o),g++}),i.append(s),ComApp.app._localizeMarkup(t),s.append(t),"1"==mobileClient&&(d={onScroll:function(e){clearTimeout(n),n=setTimeout(function(){a=e.scrollOffset},500)}}),s.dxScrollView(d).dxScrollView("instance"),l.detach(),c.html(s.find(".dx-scrollview-scrollbottom-indicator").clone()),setTimeout(function(){_$a.api("POST","634445158944375000020258",{act:"deliverytime"},function(t){var n,a=t.time;if(a.length>0){c.empty(),n=a[0];for(var i=0;i<a.length;i+=2){var r=l.clone();r.attr("id","deliver_"+a[i]),r.find("input").val(a[i]),r.append(a[i+1]),c.append(r),p.hasOwnProperty("time")&&p.time==a[i]&&(n=a[i])}c.find('input[value="'+n+'"]').prop("checked",!0),c.find("input").change(function(){e._cbCart("delivery",{time:this.value})}),$(o[1]).fadeIn("slow").find("#fastcartform input").change(function(){var t=$(this),n={};n[t.attr("f")]=t.val(),e._cbCart("delivery",n)}).each(function(e,t){var n=$(t);p.hasOwnProperty(n.attr("f"))&&n.val(p[n.attr("f")])})}})},100)},s=$("<div/>"),l=function(e){clearTimeout(n),s.data().dxScrollView.scrollTo(a)},d=function(){if(s.find("#cart_clear").click(function(t,n){DevExpress.ui.dialog.confirm('<div style="text-align:center;max-width:300px">'+gbM("S1_027")+"</div>","Confirm changes").done(function(t){t&&(scrLocked(),setTimeout(function(){var t=s.find(".removeitem"),n=t.length,a=function(){0==--n&&(f.hide(),scrReleased())};t.each(function(t,n){var i=n;setTimeout(function(){e._rmvOutCart($(i).parent().data().id,a)}),setTimeout(function(){$(i).parent().fadeOut("slow",function(e){$(this).remove(),a()})})})},10))})}),s.find(".placeorder_button").on("click",function(e){var t=!0;if("fastplaceorder"==this.id&&s.find("#fastcartform input.sodienthoai").each(function(e,n){if(""==$.trim($(n).val())){var a=$(n).parent(),i=a.parent();a.addClass("txt-invalid"),i.addClass("errdulieu"),t=!1,$(n).focus()}}),t){var n=function(e,t){if(_$q.next(!1),"0"==t.act){var n=null,i={width:300,height:270,contentTemplate:function(){var t=r[3];return ComApp.app._localizeMarkup(t),t.find(".a_demo_one").on("click",function(){n.hide(),a({act:"1"})}),t.find("img").attr("src","data:image/png;base64,"+e.captcha.CaptchaImage),t},showTitle:!0,toolbarItems:[{location:"before",toolbar:"top",widget:"dxButton",options:{icon:"refresh",elementAttr:{class:"flatbutton"},onClick:function(e){alert("here")}}},{location:"center",toolbar:"top",text:"BUOC XAC NHAN"}],onHidden:function(){c.remove()},dragEnabled:!1},c=$("<div class='captcha_popup'/>").appendTo(o);(n=c.dxPopup(i).dxPopup("instance")).show()}else f.hide();scrReleased()},a=function(e){scrLocked(),_$a.api("POST","634445158944375000020258",e,function(t){n(t,e)},function(t){n(result,e)})};a({act:"0"})}}),r.hasOwnProperty("0")){var t=function(){s.find(".resetpass").on("click",function(){var e,t=s.find(".login.chotdonhang");r.hasOwnProperty("2")?(e=r[2].clone(),ComApp.app._localizeMarkup(e),$(t[0]).parent().append(e),delete r[2],e.find("#resetpass_close").on("click",function(){var e=s.find(".login.chotdonhang"),t=s.find(".login.datlaipass");t.fadeOut(500,function(){e.fadeIn("slow"),t.find(".captcha_resetpass").empty()})})):e=s.find(".login.datlaipass"),(new jsLoader).require([dyncpath+"dx__Menu1.js"],function(){var n,a,i;n=e.find("#note"),a=function(e,t,n){var a=new Date(e),i=function(){a.getDate()!=e.getDate()&&a.setDate(0)};switch(t.toLowerCase()){case"year":a.setFullYear(a.getFullYear()+n),i();break;case"quarter":a.setMonth(a.getMonth()+3*n),i();break;case"month":a.setMonth(a.getMonth()+n),i();break;case"week":a.setDate(a.getDate()+7*n);break;case"day":a.setDate(a.getDate()+n);break;case"hour":a.setTime(a.getTime()+36e5*n);break;case"minute":a.setTime(a.getTime()+6e4*n);break;case"second":a.setTime(a.getTime()+1e3*n);break;default:a=void 0}return a}(new Date,"minute",2),i=!0,e.find(".captcha_resetpass").html(s.find(".dx-scrollview-scrollbottom-indicator").clone()),new Date>a&&(a=(new Date).getTime()+864e6,i=!1),e.find("#countdown").countdown({timestamp:a,callback:function(e,t,a,o){var r="";r+=e+" day"+(1==e?"":"s")+", ",r+=t+" hour"+(1==t?"":"s")+", ",r+=a+" minute"+(1==a?"":"s")+" and ",r+=o+" second"+(1==o?"":"s")+" <br />",r+=i?"left until the new year!":"left to 10 days from now!",n.html(r)}}),t.fadeOut(300,function(){$(".table").css({display:"none"}),e.fadeIn("slow",function(){})})})}),s.find("#dologin_close").on("click",function(){var e=s.find(".screen-placeorder");s.find(".screen-dangnhap").fadeOut(500,function(){e.fadeIn("slow"),$(".table").css({display:""}),s.data().dxScrollView.scrollTo(i)})})};s.find("#dangnhap_button").on("click",function(){i=s.data().dxScrollView.scrollOffset();var e=s.find(".screen-placeorder"),n=s.find(".screen-dangnhap");e.fadeOut(500,function(){}),setTimeout(function(){n.fadeIn("slow"),$(".table").css({display:"none"}),n.data("loginEvts")||t(),n.data("loginEvts","1")},500)}),s.find("#fastcartform input").blur(function(){var e=$(this);if(e.hasClass("sodienthoai")){var t=e.parent(),n=t.parent();t.hasClass("txt-invalid")&&""!=$.trim(e.val())&&(t.removeClass("txt-invalid"),n.removeClass("errdulieu"))}$(this).parent().parent().removeClass("dx-state-focused")}).focus(function(){$(this).parent().parent().addClass("dx-state-focused")}),s.find("#fastcartform input[type=tel]").keypress(function(e){if(32!=e.which&&8!=e.which&&0!=e.which&&(e.which<48||e.which>57))return!1})}},f=o.dxPopup({fullScreen:!0,dragEnabled:!1,showTitle:!0,deferRendering:!1,contentTemplate:function(e){c(e)},onHidden:function(){_virtualKeyboard("off",null,l),o.remove(),e.showCart=!1},onShown:function(t){e.showCart=!0,setTimeout(function(){e.cartcolQty(),t.element.find(".dx-toolbar-center").html(gbM("S1_002")),_virtualKeyboard("on",null,l),d(),scrReleased()})}}).dxPopup("instance");setTimeout(function(){f.show()},100)};